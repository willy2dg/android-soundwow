This repository contains an example application using SoundWow module, the module it self is placed in `soundwow` directory.

You can run automated instrumental tests by running the SoundWowInstrumentalTest class (in `src/androidTest`)

To include the module in your application just import the soundwow directoy using AndroidStudio `New -> Import Module`

To use it just needs a sound view reference and call `setSound` passing a `File` or `AssetFileDescriptor`, optionally you can set `seekListener` to receive seeking events

### Properties
`soundSamplesResume: SoundSamplesResume` a class containing a resume of sound samples or null if there is no sound loaded.\
`progress: Float` a float between 0.0 and 1.0 representing the sound view progress.\
`seekListener: OnSeekListener` a interface to interact with seek events.\
`samplesGrouper: SamplesGrouper` a interface which groups the samples for every block\
`displayNegative: Boolean` a boolean to enable negative samples, if false the bottom part of the sound wave is not displayed and wave is aligned to the bottom.\
`blockDrawer: BlockDrawer` a interface used to display the block values\
`blockMargin: Int` a int representing pixel separation between blocks.\
`blockMinHeight: Int` a int representing block minimum height in pixels.\
`blockSize: Int` a int representing pixel block size.\
`playerBlockColor: Int` a int color used to paint the played part of the sound.\
`notPlayedBlockColor: Int` a int color used to paint the not played part of the sound.

### Methods
`setSound(file: File)` load sound file\
`setSound(assetFileDescriptor: AssetFileDescriptor)` load sound asset

### Interfaces
```
OnSeekListener {
    // all methods receive a value between 0.0 and 1.0 representing the selected progress
    fun onSeekBegin(progress: Float) // fired when user long tap to drag the progress
    fun onSeekUpdate(progress: Float) // fired when user is dragging
    fun onSeekComplete(progress: Float) // fired on tap or when dragginf is released
}
```
Placed in `seekListener` propertie, is used to react to user seeking
```
SamplesGrouper {
    fun groupSamples(
        samples: ShortBuffer, // where the samples should be readed
        blockAmount: Int, // amount of block which should be returned by this function
        samplesAmount: Int, // amount of samples to be readed for each block
        normalizeFactor: Float // value to scale sample altitude on view height, each computed value should be scaled using this
    ): ShortArray
}
```
Placed in `samplesGrouper` propertie, is used to groups all samples for a block, returning a BlockResume
```
BlockDrawer {
    fun drawBlocks(
        canvas: Canvas, // canvas to draw on 
        blockSettings: BlockSettings, // sound view block setting
        blocksValues: ShortArray, // the array containing all block values
        topOrigin: Float, // precomputed smallest value for positive samples
        bottomOrigin: Float, // precomputed smallest value for negative samples
        currentBlock: Int // index of currently played block
    )
}
```
Placed in `blockDrawer` propertie, is used to draw the blocks in the canvas. `topOrigin` and `bottomOrigin` are precomputed values pointing Y coordenates on the canvas, they take in count `blockSetting` and canvas size to mark minimum Y values for positive and negative samples. So positive block value should be increased to `topOrigin` to get highest Y for each block and negative block value decreased to `bottomOrigin` in order to get lowerst Y for each block.
    
### Custom XML attributes
All these attributes correspond to a class propertie\
`display_negative` boolean\
`block_margin` integer\
`block_size` integer\
`block_min_height` integer\
`played_block_color` color\
`not_played_block_color` color

### Internal classes

`SoundSamplesResume` is the class generated by `setSound` and stored in `soundSamplesResume` propertie, it contains a resume of decoded sound samples with the following properties :

`samples: ShortBuffer` sound samples resume\
`samplesCount: Int` the number of samples you can read from `samples`\

`BlockSetting` is a container class grouping all block setting ( which are XML attributtes too )